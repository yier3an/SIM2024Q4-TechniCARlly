<!DOCTYPE html>
<html>
<head>
	<title>TechniCARlly</title>
	<link rel="stylesheet" href="../static/styles.css" type="text/css" />

	<!-- Import Firebase Configuration -->
	<script type="module" src="../../firebaseConfig.js"></script>
	<script type="module" src="../entities/userAccount.js"></script>
</head>

<body>
	<div class="navbar">
		<span id="group_name">TechniCARlly</span>
	</div>

	<div id="login_form">
		<h2>Login</h2>
		<form name="login" onsubmit="return false;" method="post">
			<table>
				<tr>
					<td><label for="username">Username: </label></td>
					<td class="field_input"><input type="text" id="username" name="username" required /></td>
				</tr>
				<tr>
					<td><label for="password">Password: </label></td>
					<td class="field_input"><input type="password" id="password" name="password" required /></td>
				</tr>
			</table>
		</form>

		<div id="login_info">
			<span id="err_mess"></span>
			<button type="submit" id="login_btn">Login</button>
		</div>
	</div>

	<!-- Button to Create an Admin User for Testing -->
	<div id="create_admin_form">
		<h3>Create Admin User (Testing)</h3>
		<button id="createAdminBtn">Create Admin User</button>
	</div>

	<script type="module">
		// Import the auth and db instances from firebaseConfig
		import { auth, db } from "../../firebaseConfig.js";
		import { signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
		import { doc, setDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

		// Login function
		function login() {
			const email = document.getElementById("username").value;
			const password = document.getElementById("password").value;

			signInWithEmailAndPassword(auth, email, password)
				.then((userCredential) => {
					window.location.href = "adminPages/adminHome.html"; // Redirect to admin homepage
				})
				.catch((error) => {
					document.getElementById("err_mess").innerText = error.message;
				});
		}

		// Event listener for login button
		document.getElementById("login_btn").addEventListener("click", login);

		// Create Admin User Functionality
		async function createAdminUser() {
			const email = "tester222@example.com"; // Admin email for testing
			const password = "123456";           // Admin password for testing
			const role = "admin";

			try {
				// Create user with email and password
				const userCredential = await createUserWithEmailAndPassword(auth, email, password);
				const userId = userCredential.user.uid;

				// Add user data to Firestore with the role 'admin'
				await setDoc(doc(db, "UserAccount", userId), {
					email: email,
					role: role,
				});
				
				alert("Admin user 'tester' created successfully");
			} catch (error) {
				alert("Error creating admin user: " + error.message);
			}
		}

		// Event listener for create admin button
		document.getElementById("createAdminBtn").addEventListener("click", createAdminUser);
	</script>

	<!-- Custom JavaScript file for handling login UI -->
	<script type="module" src="../boundaries/loginUI.js"></script>

</body>
</html>
